<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ æ¼«ç”»æ¡£æ¡ˆå®¤ | ComicInfo Editor</title>
    <style>
        /* ============================================
           1. å…¨å±€å˜é‡ (Color & Theme)
           ============================================ */
        :root {
            --bg-body: #f4f1ea;          /* ç±³è‰²èƒŒæ™¯ */
            --bg-card: #ffffff;          /* å¡ç‰‡çº¯ç™½ */
            --primary: #c96a7b;          /* ä¸»è‰²ï¼šå¹²æ¯ç«ç‘° */
            --primary-light: #fcecef;    /* æµ…ç²‰ç‚¹ç¼€ */
            --text-main: #4a3c3c;        /* æ·±å’–è‰²æ–‡å­— */
            --text-sub: #7d6b6b;         /* æš–ç°è‰²è¾…æ–‡ */
            --border: #dcbabf;           /* è¾¹æ¡†è‰² */
            --input-bg: #fcfbf9;         /* è¾“å…¥æ¡†åº•è‰² */
            --focus: #c96a7b;            /* èšç„¦é«˜äº® */
            --radius: 10px;              /* åœ†è§’ç»Ÿä¸€ */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Nunito", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-body);
            /* èƒŒæ™¯ç½‘æ ¼çº¹ç† */
            background-image: 
                linear-gradient(rgba(200, 180, 180, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(200, 180, 180, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            padding: 20px;
            font-size: 13px;
        }

        /* ============================================
           2. å¸ƒå±€ç»“æ„ (Layout)
           ============================================ */
        .container {
            max-width: 1050px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 340px; /* å·¦è‡ªä¸»ï¼Œå³å›ºå®š */
            gap: 16px;
            align-items: start;
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 12px;
            padding: 16px;
            background: #fff;
            border-radius: var(--radius);
            box-shadow: 0 2px 10px rgba(201, 106, 123, 0.08);
            border: 1px solid var(--border);
        }
        h1 { margin: 0; font-size: 1.4rem; color: var(--primary); font-weight: 700; }
        .subtitle { font-size: 0.85rem; color: var(--text-sub); margin-top: 4px; }

        /* ============================================
           3. é€šç”¨ç»„ä»¶ (Components)
           ============================================ */
        /* å¡ç‰‡åŸºç¡€ */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 1px 4px rgba(0,0,0,0.02);
        }
        .card-header {
            font-size: 0.95rem; font-weight: 700;
            color: var(--text-main);
            margin-bottom: 12px; padding-bottom: 8px;
            border-bottom: 1px dashed var(--border);
            display: flex; align-items: center;
        }
        .card-header span { color: var(--primary); font-size: 1.1em; margin-right: 6px; }

        /* æ …æ ¼ç³»ç»Ÿ */
        .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 10px; }
        .col-12 { grid-column: span 12; }
        .col-6  { grid-column: span 6; }
        .col-4  { grid-column: span 4; }

        /* è¡¨å•æ§ä»¶ */
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 3px; font-weight: 600; }

        input:not([type="range"]), select, textarea {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text-main);
            background: var(--input-bg);
            width: 100%; height: 32px;
            transition: border-color 0.2s;
        }
        textarea { height: auto; min-height: 60px; resize: vertical; line-height: 1.4; }

        /* è¾“å…¥æ¡†èšç„¦æ•ˆæœ */
        input:not([type="range"]):focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--focus);
            background: #fff;
            box-shadow: 0 0 0 2px rgba(201, 106, 123, 0.15);
        }

        /* è¯„åˆ†æ»‘å— */
        .slider-container {
            display: flex; align-items: center; gap: 10px;
            background: var(--input-bg); padding: 4px 10px;
            border: 1px solid var(--border); border-radius: 6px; height: 32px;
        }
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background: #e0d0d0; border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 14px; height: 14px;
            border-radius: 50%; background: var(--primary);
            cursor: pointer; border: 2px solid white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        .rating-display { font-weight: bold; color: var(--primary); font-size: 0.95em; min-width: 50px; text-align: right; }

        /* æ ‡ç­¾æŒ‰é’® */
        .tag-area { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
        .tag-btn {
            font-size: 0.75rem; padding: 2px 10px;
            background: #fff; border: 1px solid var(--border); border-radius: 15px;
            color: var(--text-sub); cursor: pointer; user-select: none;
            transition: all 0.2s;
        }
        .tag-btn:hover { background: var(--primary-light); color: var(--primary); border-color: var(--primary); }

        /* ============================================
           4. ä¾§è¾¹æ ä¸ç‰¹æ®ŠåŠŸèƒ½ (Sidebar)
           ============================================ */
        .sidebar { position: sticky; top: 10px; }

        /* ä¸Šä¼ æ¡† */
        .upload-box {
            border: 2px dashed var(--border); border-radius: var(--radius);
            padding: 20px; text-align: center; background: #fff;
            cursor: pointer; transition: all 0.2s; margin-bottom: 16px;
            color: var(--text-sub); position: relative;
        }
        .upload-box:hover, .upload-box.drag-over {
            border-color: var(--primary); background: var(--primary-light); color: var(--primary);
        }
        .upload-icon { font-size: 24px; display: block; margin-bottom: 5px; }

        /* é¢„è§ˆæ¡†å®¹å™¨ */
        .preview-wrapper { position: relative; width: 100%; }
        
        /* é¢„è§ˆæ–‡æœ¬åŸŸ */
        .preview-box {
            width: 100%; 
            height: 440px; /* é«˜åº¦å‡å°‘ */
            font-family: "Consolas", "Monaco", monospace; font-size: 11px;
            background: #3d3436; color: #fcebeb;
            border: none; padding: 12px; padding-top: 35px;
            border-radius: 6px; resize: none; white-space: pre;
            display: block;
        }
        
        /* å¼ºåˆ¶é¢„è§ˆæ¡†èšç„¦æ—¶ä¸æ”¹å˜èƒŒæ™¯è‰² */
        .preview-box:focus {
            background-color: #3d3436 !important;
            color: #fcebeb !important;
            outline: none !important;
            box-shadow: none !important;
        }

        /* æ‚¬æµ®å¤åˆ¶æŒ‰é’® */
        .btn-copy-float {
            position: absolute; top: 8px; right: 8px;
            padding: 4px 10px; font-size: 11px;
            background: rgba(255, 255, 255, 0.15); color: #fcebeb;
            border: 1px solid rgba(255,255,255,0.2); border-radius: 4px;
            cursor: pointer; z-index: 10;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-copy-float:hover { background: #fff; color: var(--primary); transform: scale(1.05); }
        .btn-copy-float:active { transform: scale(0.9); }
        
        /* å¤åˆ¶æˆåŠŸæ—¶çš„åŠ¨æ•ˆç±» */
        .btn-copy-float.copied {
            background: #fff; color: var(--primary); border-color: var(--primary);
            animation: pop 0.3s ease;
        }
        @keyframes pop {
            0% { transform: scale(0.9); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* åº•éƒ¨æ“ä½œæŒ‰é’® */
        .action-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 20px;
            font-size: 0.95rem; font-weight: 700; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.2s, background 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 3px 8px rgba(201, 106, 123, 0.25); }
        .btn-primary:hover { opacity: 0.9; }
        .btn-reset-block { background: white; border: 2px solid #e0d0d0; color: #8a7a7a; }
        .btn-reset-block:hover { border-color: var(--primary); color: var(--primary); background: #fff8f9; }

        /* ä»‹ç»ä¿¡æ¯ */
        .intro-box {
            margin-top: 16px; padding: 15px; background: #fdfaf8;
            border: 1px dashed var(--border); border-radius: var(--radius);
            font-size: 0.8rem; color: var(--text-sub); line-height: 1.6;
        }
        .intro-box h4 { margin: 0 0 5px 0; color: var(--primary); font-size: 0.9rem; }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 850px) {
            .container { grid-template-columns: 1fr; }
            .sidebar { position: static; }
            .col-6 { grid-column: span 12; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header>
            <h1>ğŸŒ¸ æ¼«ç”»æ¡£æ¡ˆå®¤ ComicInfo</h1>
            <div class="subtitle">è®©æ•´ç†æ¼«ç”»å˜æˆä¸€ä»¶æ²»æ„ˆçš„å°äº‹ ~</div>
        </header>

        <!-- å·¦ä¾§ï¼šè¡¨å•ç¼–è¾‘åŒº -->
        <div class="main-content">
            
            <!-- 1. èº«ä»½ä¿¡æ¯ -->
            <div class="card">
                <div class="card-header"><div><span>ğŸ·ï¸</span> èº«ä»½ä¿¡æ¯</div></div>
                <div class="grid">
                    <div class="form-group col-12"><label>ç³»åˆ—åç§° (Series)</label><input type="text" id="Series" placeholder="ä¾‹å¦‚ï¼šç™¾å˜å°æ¨±"></div>
                    <div class="form-group col-12"><label>æœ¬å·/æœ¬è¯æ ‡é¢˜ (Title)</label><input type="text" id="Title" placeholder="ä¾‹å¦‚ï¼šè¢«å°å°çš„å¡ç‰‡"></div>
                    <div class="form-group col-12"><label>åŸå / åˆ«å (AlternateSeries)</label><input type="text" id="AlternateSeries" placeholder="ä¾‹å¦‚ï¼šã‚«ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ—ã‚¿ãƒ¼ã•ãã‚‰"></div>
                    <!-- è¯æ•°ä½¿ç”¨ number ç±»å‹ -->
                    <div class="form-group col-4"><label>è¯æ•° No.</label><input type="number" id="Number" placeholder="#"></div>
                    <div class="form-group col-4"><label>å·å· Vol.</label><input type="number" id="Volume" placeholder="Vol"></div>
                    <div class="form-group col-4"><label>æ€»æ•° Count</label><input type="number" id="Count"></div>
                </div>
            </div>

            <!-- 2. æ¡£æ¡ˆä¸è¯„ä»· -->
            <div class="card">
                <div class="card-header"><div><span>âš™ï¸</span> æ¡£æ¡ˆä¸è¯„ä»·</div></div>
                <div class="grid">
                    <div class="form-group col-6">
                        <label>è¯­è¨€ (Language)</label>
                        <div style="display:flex; gap:6px;">
                            <select onchange="setLanguage(this.value)" style="width:90px; flex-shrink:0; background-color:#f2efeb;">
                                <option value="" disabled selected>é€‰æ‹©</option>
                                <option value="zh">ä¸­æ–‡</option>
                                <option value="ja">æ—¥æ–‡</option>
                                <option value="en">è‹±æ–‡</option>
                            </select>
                            <input type="text" id="LanguageISO" value="zh">
                        </div>
                    </div>
                    <div class="form-group col-6">
                        <label>é˜…è¯»æ–¹å‘ (Manga)</label>
                        <select id="Manga">
                            <option value="" selected>â“ ä¸æŒ‡å®š</option>
                            <option value="No">â¡ï¸ ä»å·¦åˆ°å³ (æ¬§ç¾)</option>
                            <option value="Yes">â¬…ï¸ ä»å³åˆ°å·¦ (æ—¥æ¼«)</option>
                            <option value="YesAndRightToLeft">â¬…ï¸ ä»å³åˆ°å·¦ (å¼ºåˆ¶)</option>
                        </select>
                    </div>
                    <div class="form-group col-12">
                        <label>æ¨èè¯„åˆ† (Rating)</label>
                        <div class="slider-container">
                            <input type="range" id="CommunityRating" min="0" max="5" step="0.5" value="0" oninput="updateRatingDisplay(this.value)">
                            <div class="rating-display">
                                <span id="rating-val-text">0.0</span> <span style="font-size:0.8em">â­</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-6">
                        <label>å¹´é¾„åˆ†çº§ (Age)</label>
                        <select id="AgeRating">
                            <option value="">é»˜è®¤</option>
                            <option value="Everyone">ğŸŸ¢ å…¨å¹´é¾„</option>
                            <option value="Teen">ğŸ”µ é’å°‘å¹´ (13+)</option>
                            <option value="Mature 17+">ğŸŸ£ é’å¹´ (17+)</option>
                            <option value="Adults Only 18+">ğŸ”´ æˆäºº (18+)</option>
                        </select>
                    </div>
                    <div class="form-group col-6">
                        <label>å®Œç»“çŠ¶æ€ (Status)</label>
                        <!-- ä¸¥æ ¼é™å®šå››ä¸ªçŠ¶æ€å€¼ -->
                        <select id="Status">
                            <option value="">ä¸æŒ‡å®š</option>
                            <option value="Ongoing">ğŸ“– è¿è½½ä¸­</option>
                            <option value="Ended">âœ… å·²å®Œç»“</option>
                            <option value="Hiatus">â¸ï¸ ä¼‘åˆŠ/æš‚åœ</option>
                            <option value="Cancelled">âŒ å–æ¶ˆ/è…°æ–©</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 3. äººå‘˜ä¸å‡ºç‰ˆ -->
            <div class="card">
                <div class="card-header"><div><span>ğŸ¨</span> äººå‘˜ä¸å‡ºç‰ˆ</div></div>
                <div class="grid">
                    <div class="form-group col-6"><label>è„šæœ¬/ä½œè€…</label><input type="text" id="Writer"></div>
                    <div class="form-group col-6"><label>ä½œç”»/ç”»å¸ˆ</label><input type="text" id="Penciller"></div>
                    <div class="form-group col-6"><label>æ±‰åŒ–/ç¿»è¯‘</label><input type="text" id="Translator"></div>
                    <div class="form-group col-6"><label>ç¼–è¾‘</label><input type="text" id="Editor"></div>
                    <div class="form-group col-6"><label>å‡ºç‰ˆç¤¾</label><input type="text" id="Publisher" placeholder="ä¾‹å¦‚ï¼šé›†è‹±ç¤¾"></div>
                    <div class="form-group col-6"><label>æ¥æºç½‘å€</label><input type="text" id="Web" placeholder="ä¾‹å¦‚ï¼šhttps://..."></div>
                    <div class="form-group col-4"><label>å¹´ Year</label><input type="number" id="Year"></div>
                    <div class="form-group col-4"><label>æœˆ Month</label><input type="number" id="Month"></div>
                    <div class="form-group col-4"><label>æ—¥ Day</label><input type="number" id="Day"></div>
                </div>
            </div>

            <!-- 4. å†…å®¹è¯¦æƒ… -->
            <div class="card">
                <div class="card-header"><div><span>ğŸ“</span> å†…å®¹è¯¦æƒ…</div></div>
                <div class="grid">
                    <div class="form-group col-12"><label>å‰§æƒ…ç®€ä»‹ (Summary)</label><textarea id="Summary"></textarea></div>
                    <div class="form-group col-12">
                        <label>é¢˜æåˆ†ç±» (Genre)</label>
                        <input type="text" id="Genre" placeholder="ç‚¹å‡»ä¸‹æ–¹å¿«é€Ÿæ·»åŠ ...">
                        <div class="tag-area" id="genre-presets"></div>
                    </div>
                    <div class="form-group col-12">
                        <label>å¸¸ç”¨æ ‡ç­¾ (Tags)</label>
                        <input type="text" id="Tags" placeholder="ç‚¹å‡»ä¸‹æ–¹å¿«é€Ÿæ·»åŠ ...">
                        <div class="tag-area" id="status-presets"></div>
                    </div>
                    <div class="form-group col-12"><label>å¤‡æ³¨ (Notes)</label><input type="text" id="Notes"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šä¾§è¾¹æ  -->
        <div class="sidebar">
            
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div id="drop-zone" class="upload-box" onclick="document.getElementById('file-input').click()">
                <span class="upload-icon">ğŸ“‚</span>
                <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ XML æ–‡ä»¶</div>
                <div class="upload-sub">è‡ªåŠ¨è¯»å–ç°æœ‰ ComicInfo ä¿¡æ¯</div>
                <input type="file" id="file-input" hidden accept=".xml" onchange="handleFileUpload(this.files)">
            </div>

            <!-- é¢„è§ˆä¸æ“ä½œ -->
            <div class="card" style="border: 2px dashed var(--primary); background: #fffcfc; padding-top:10px;">
                <div class="card-header" style="justify-content: center; color: var(--primary); border:none; margin-bottom:5px;">
                    ğŸ” æ¡£æ¡ˆé¢„è§ˆ
                </div>
                
                <div class="preview-wrapper">
                    <!-- å¤åˆ¶æŒ‰é’® -->
                    <button class="btn-copy-float" onclick="copyToClipboard()" title="å¤åˆ¶å†…å®¹">ğŸ“‹ å¤åˆ¶</button>
                    <!-- é¢„è§ˆæ–‡æœ¬æ¡† -->
                    <textarea id="preview" class="preview-box" readonly></textarea>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateAndDownload()">
                        ğŸ“¥ ç”Ÿæˆå¹¶ä¸‹è½½ XML
                    </button>
                    <button class="btn btn-reset-block" onclick="resetForm()">
                        ğŸ”„ æ¸…ç©ºé‡ç½®
                    </button>
                </div>
            </div>

            <!-- é¡¹ç›®ç®€ä»‹ -->
            <div class="intro-box">
                <h4>ğŸŒ¸ å…³äºæœ¬é¡¹ç›®</h4>
                <p>
                    è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ <b>ComicInfo.xml</b> ç¼–è¾‘å™¨ã€‚
                    <br>
                    â€¢ <b>å¯¼å…¥åŠŸèƒ½</b>ï¼šä¸Šæ–¹å¯ç›´æ¥å¯¼å…¥æ—§æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚
                    <br>
                    â€¢ <b>å®‰å…¨éšç§</b>ï¼šçº¯æœ¬åœ°è¿è¡Œï¼Œæ— æ•°æ®ä¸Šä¼ ã€‚
                    <br>
                    â€¢ <b>å…¼å®¹æ€§</b>ï¼šå®Œç¾æ”¯æŒ <b>Komga</b>ã€<b>Tachiyomi</b> ç­‰ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        /* ============================================
           æ ¸å¿ƒæ•°æ®å®šä¹‰
           ============================================ */
        // é¢˜æä¸æ ‡ç­¾é¢„è®¾
        const genreList = ["å¥³æ€§å‘", "æ‹çˆ±", "çº¯çˆ±", "æ ¡å›­", "ç™¾åˆ", "å–œå‰§", "å¥‡å¹»", "é­”æ³•", "æ²»æ„ˆ", "æ—¥å¸¸", "å‰§æƒ…", "å†’é™©", "å¤é£", "èŒåœº", "åå®«", "å¼‚ä¸–ç•Œ", "æ‚¬ç–‘"];
        const tagList = ["è¿è½½ä¸­", "å·²å®Œç»“", "å½©è‰²", "é»‘ç™½", "å¤ä»‡", "å•è¡Œæœ¬", "åŒäºº", "WEBæ¼«", "æ— ä¿®", "å®˜æ–¹æ±‰åŒ–", "ä¸ªäººæ±‰åŒ–", "NTR", "è§¦æ‰‹"];
  
        // è¡¨å•å­—æ®µæ˜ å°„
        const allFields = [
            'Series', 'Title', 'AlternateSeries', 'Number', 'Volume', 'Count',
            'Summary', 'Notes', 'Year', 'Month', 'Day',
            'Writer', 'Penciller', 'Translator', 'Editor',
            'Publisher', 'Web', 'Genre', 'Tags', 'Status',
            'LanguageISO', 'Manga', 'AgeRating', 'CommunityRating'
        ];

        /* ============================================
           åˆå§‹åŒ–é€»è¾‘
           ============================================ */
        window.onload = function() {
            renderTags();        // 1. æ¸²æŸ“å¿«æ·æ ‡ç­¾
            setDefaultDate();    // 2. å¡«å……æ—¥æœŸ
            bindEvents();        // 3. ç»‘å®šç›‘å¬
            setupDragAndDrop();  // 4. åˆå§‹åŒ–æ‹–æ‹½
            updatePreview();     // 5. é¦–æ¬¡é¢„è§ˆ
        };

        function bindEvents() {
            // ç›‘æ§æ‰€æœ‰è¾“å…¥å˜åŒ–
            document.querySelectorAll('input:not([type="range"]), select, textarea').forEach(el => {
                el.addEventListener('input', updatePreview);
                el.addEventListener('change', updatePreview);
            });
        }

        /* ============================================
           è¾…åŠ©åŠŸèƒ½å‡½æ•°
           ============================================ */
        // æ¸²æŸ“æ ‡ç­¾ DOM
        function renderTags() {
            const createBadge = (text, id) => {
                const s = document.createElement('span');
                s.className = 'tag-btn';
                s.textContent = text;
                s.onclick = () => addTag(id, text);
                return s;
            };
            genreList.forEach(t => document.getElementById('genre-presets').appendChild(createBadge(t, 'Genre')));
            tagList.forEach(t => document.getElementById('status-presets').appendChild(createBadge(t, 'Tags')));
        }

        // æ·»åŠ æ ‡ç­¾å€¼
        function addTag(id, text) {
            const el = document.getElementById(id);
            let val = el.value.trim();
            if (val && !val.includes(text)) {
                el.value = val + ((val.endsWith(',') || val.endsWith('ï¼Œ')) ? ' ' : ', ') + text;
            } else if (!val) {
                el.value = text;
            }
            updatePreview();
        }

        // è¯­è¨€/æ—¥æœŸ/è¯„åˆ†è®¾ç½®
        function setLanguage(val) { document.getElementById('LanguageISO').value = val; updatePreview(); }
        function updateRatingDisplay(val) { document.getElementById('rating-val-text').textContent = parseFloat(val).toFixed(1); updatePreview(); }
        function setDefaultDate() {
            const d = new Date();
            document.getElementById('Year').value = d.getFullYear();
            document.getElementById('Month').value = d.getMonth() + 1;
            document.getElementById('Day').value = d.getDate();
        }

        /* ============================================
           XML è¯»å–ä¸å†™å…¥
           ============================================ */
        function setupDragAndDrop() {
            const dropZone = document.getElementById('drop-zone');
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(n => {
                dropZone.addEventListener(n, e => { e.preventDefault(); e.stopPropagation(); }, false);
            });
            ['dragenter', 'dragover'].forEach(n => dropZone.addEventListener(n, () => dropZone.classList.add('drag-over')));
            ['dragleave', 'drop'].forEach(n => dropZone.addEventListener(n, () => dropZone.classList.remove('drag-over')));
            dropZone.addEventListener('drop', e => handleFileUpload(e.dataTransfer.files));
        }

        function handleFileUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                if (file.type === "text/xml" || file.name.endsWith(".xml")) {
                    const reader = new FileReader();
                    reader.onload = e => parseAndPopulate(e.target.result);
                    reader.readAsText(file);
                } else { alert("è¯·ä¸Šä¼ æœ‰æ•ˆçš„ XML æ–‡ä»¶"); }
            }
        }

        function parseAndPopulate(xmlText) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                allFields.forEach(field => {
                    const element = xmlDoc.querySelector(field);
                    const inputEl = document.getElementById(field);
                    if (element && inputEl) {
                        const val = element.textContent;
                        if (field === 'CommunityRating') { inputEl.value = val; updateRatingDisplay(val); }
                        else { inputEl.value = val; }
                    }
                });
                updatePreview();
                alert("ğŸŒ¸ è¯»å–æˆåŠŸï¼æ•°æ®å·²è‡ªåŠ¨å¡«å……");
            } catch (e) { console.error(e); alert("XML è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼"); }
        }

        /* ============================================
           XML ç”Ÿæˆä¸å¯¼å‡º
           ============================================ */
        function escapeXml(str) {
            if (!str) return "";
            return str.replace(/[<>&'"]/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;','\'':'&apos;','"':'&quot;'}[c]));
        }

        function createXMLString() {
            const getVal = id => escapeXml(document.getElementById(id)?.value.trim() || "");
            let xml = '<?xml version="1.0"?>\n<ComicInfo xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n';
            allFields.forEach(f => {
                const v = getVal(f);
                if (v !== "" && !(f === 'CommunityRating' && v === '0')) xml += `  <${f}>${v}</${f}>\n`;
            });
            xml += '</ComicInfo>';
            return xml;
        }

        function updatePreview() { document.getElementById('preview').value = createXMLString(); }

        function generateAndDownload() {
            const blob = new Blob([createXMLString()], { type: "text/xml;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url; a.download = "ComicInfo.xml";
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        /* ============================================
           å‰ªè´´æ¿æ“ä½œ (å¸¦åŠ¨æ•ˆ)
           ============================================ */
        function copyToClipboard() {
            const el = document.getElementById("preview");
            const btn = document.querySelector('.btn-copy-float');
            
            el.select();
            navigator.clipboard.writeText(el.value).then(() => {
                const oldText = "ğŸ“‹ å¤åˆ¶";
                btn.classList.add('copied');    // æ·»åŠ åŠ¨æ•ˆç±»
                btn.innerHTML = "âœ¨ å·²å¤åˆ¶";
                setTimeout(() => {              // 2ç§’åå¤åŸ
                    btn.classList.remove('copied');
                    btn.innerHTML = oldText;
                }, 2000);
            });
        }

        function resetForm() {
            if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ")) {
                document.querySelectorAll('input:not([type="range"]), textarea').forEach(e => e.value = "");
                document.querySelectorAll('select').forEach(e => e.selectedIndex = 0);
                document.getElementById('CommunityRating').value = 0;
                document.getElementById('rating-val-text').textContent = "0.0";
                setDefaultDate();
                document.getElementById('LanguageISO').value = 'zh';
                updatePreview();
            }
        }
    </script>
</body>
</html>
